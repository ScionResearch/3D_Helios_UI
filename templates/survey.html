{% extends 'base.html' %}
{% block title %} Helios UI {% endblock %}
{% block style %}
    .hero-body {
        align-items: flex-start !important;
    }
    #modal .modal-card-body  {
        height: 600px !important;
    }
{% endblock %}
{% block hero %}
<div class="modal" id="modal">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">Survey has been saved successfully. Running Helios ...</p>
      <button class="delete" aria-label="close" onclick="killHelios('modal')"></button>
    </header>
    <section class="modal-card-body">
      <ul id="logs">

      </ul>
    </section>
    <footer class="modal-card-foot">
      <button class="button" id="download_helios_output" onclick="downloadHeliosOutput()" disabled>Download Output</button>
      <button class="button" onclick="killHelios('modal')">Cancel</button>
    </footer>
  </div>
</div>
<div class="modal" id="modal-scene">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">Upload Scene zip file</p>
      <button class="delete" aria-label="close" onclick="toggleModal('modal-scene')"></button>
    </header>
    <section class="modal-card-body">
        <form id="upload_form" enctype="multipart/form-data" method="post">
          <input type="file" name="file1" id="file1" onchange="uploadFile()" accept="application/zip"><br>
          <progress id="progressBar" value="0" max="100" style="width:300px;"></progress>
          <h3 id="status"></h3>
          <p id="loaded_n_total"></p>
        </form>
    </section>
  </div>
</div>
<div class="modal" id="modal-scanner">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">Add New Scanner</p>
      <button class="delete" aria-label="close" onclick="toggleModal('modal-scanner')"></button>
    </header>
    <section class="modal-card-body">
        <div class="content">
            <form id="scanner-form">
            <div class="field">
              <label class="label">ID</label>
              <div class="control">
                <input class="input" name="@id" type="text" placeholder="scanner id" required>
              </div>
            </div>
            <h3 class="subtitle">Scanner Definitions</h3>
            <div class="field">
              <label class="label">Accuracy</label>
              <div class="control">
                <input class="input" type="text" name="@accuracy_m" placeholder="Sensor accuracy [meters]">
              </div>
            </div>

            <div class="field">
              <label class="label">Beam Divergence<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="The 1/e^2 beam divergence full-angle [rad] (default: 0.0003). If a technical sheet gives the beam divergence at the 1/e power points or at 50% peak intensity (full width half maximum/FWHM), it has to be converted"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
              <div class="control">
                <input class="input" type="text" name="@beamDivergence_rad" placeholder="The 1/e^2 beam divergence full-angle [rad] (default: 0.0003)">
              </div>
            </div>

            <div class="field">
              <label class="label">Deflect Angle</label>
              <div class="control">
                <input class="input" type="text" name="@deflectAngle_deg" placeholder="deflect angle in degree">
              </div>
            </div>

            <div class="field">
              <label class="label">Scanner Name</label>
              <div class="control">
                <input class="input" type="text" name="@name" placeholder="scanner name" required>
              </div>
            </div>

            <div class="field">
              <label class="label">Scanner Optics<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Laser beam deflector. The supported deflectors are: (a) rotating mirror (rotating) with the optional parameter scanAngleEffectiveMax_deg (b) fiber array (line) with the optional parameter numFibers
                                    (c) oscillating mirror (oscillating) with the optional parameter scanProduct. The maximum scan product determines the maximum scanner velocity. It is the product of the maximum scan rate and maximum scan angle, which are inversely proportional to each other (Ussyshkin et al. 2008).
                                    (d) conic mirror (conic) (e) risley prims (risley) with the parameters rotorFreq1_Hz and rotorFreq2_Hz, i.e., the rotational speeds of the two prisms. note that the parameter scanFreq_Hz is not used for this beam deflector!"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
              <div class="control">
                <input class="input" type="text" name="@optics" placeholder=" Laser beam deflector. Possible values:'rotating', 'line', 'oscillating', 'conic', 'risley'" required>
              </div>
            </div>

            <div class="field">
              <label class="label">Pulse Frequency</label>
              <div class="control">
                <input class="input" type="text" name="@pulseFreqs_Hz" placeholder="List of supported pulse frequency or frequencies [Hz]">
              </div>
            </div>


            <div class="field">
              <label class="label">Pulse Length</label>
              <div class="control">
                <input class="input" type="text" name="@pulseLength_ns" placeholder="Laser pulse length/duration [ns] (default: 4.0)">
              </div>
            </div>

            <div class="field">
              <label class="label">Minimum Range</label>
              <div class="control">
                <input class="input" type="text" name="@rangeMin_m" placeholder="Minimum range [meters]">
              </div>
            </div>

            <div class="field">
              <label class="label">Maximum Scanner Angle</label>
              <div class="control">
                <input class="input" type="text" name="@scanAngleMax_deg" placeholder="Maximum possible scan angle [deg]">
              </div>
            </div>

            <div class="field">
              <label class="label">Minimum Scanner Frequency</label>
              <div class="control">
                <input class="input" type="text" name="@scanFreqMin_Hz" placeholder="Minimum values to define the possible scan frequency range [Hz]">
              </div>
            </div>

            <div class="field">
              <label class="label">Maximum Scanner Frequency</label>
              <div class="control">
                <input class="input" type="text" name="@scanFreqMax_Hz" placeholder="Maximum values to define the possible scan frequency range [Hz]">
              </div>
            </div>

            <div class="field">
                <label class="label">Effective Maximum San Angle</label>
                <div class="control">
                    <input class="input" type="text" name="@scanAngleEffectiveMax_deg" placeholder="Effective Maximum San Angle in deg">
                </div>
            </div>

            <div class="field">
                <label class="label">Wavelength</label>
                <div class="control">
                    <input class="input" type="text" name="@wavelength_nm" placeholder="Wavelength [nm] (default: 1064)">
                </div>
            </div>

            <div class="field">
              <label class="label">First Rotor Frequency</label>
              <div class="control">
                <input class="input" type="text" name="@rotorFreq1_Hz" placeholder="First Rotor Frequency">
              </div>
            </div>

            <div class="field">
              <label class="label">Second Rotor Frequency</label>
              <div class="control">
                <input class="input" type="text" name="@rotorFreq2_Hz" placeholder="Second Rotor Frequency">
              </div>
            </div>

            <div class="field">
              <label class="label">Maximum NOR<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Maximum number of returns per pulse, e.g., if maxNOR equals 1, only the first return is recorded for each pulse. If maxNOR is 0 (default), the number of returns per pulse is not limited."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
              <div class="control">
                <input class="input" type="text" name="@maxNOR" placeholder="Maximum number of returns per pulse">
              </div>
            </div>

            <div class="field">
              <label class="label">Average Power<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="The average power emitted by the laser. Integrating the whole footprint will give this power [W] (default: 4.0)."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
              <div class="control">
                <input class="input" type="text" name="@averagePower_w" placeholder="Average power emitted by the laser. Integrating the whole footprint will give this power [W] (default: 4.0)">
              </div>
            </div>

            <div class="field">
              <label class="label">Number of Fibers</label>
              <div class="control">
                <input class="input" type="text" name="@numFibers" placeholder="Number of Fibers">
              </div>
            </div>

            <div class="field">
                      <label class="label">Beam Quality Factor<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip=" How well the beam is focussed. The beam waist radius is calculated and is assumed at the minimum range as defined above. Do not confuse with the Beam Sample Quality, which defines the number of subrays used (default: 1.0)."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                      <div class="control">
                        <input class="input" type="text" name="@beamQualityFactor" placeholder="How well the beam is focussed">
                      </div>
                    </div>

            <div class="field">
              <label class="label">Optical Efficiency<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Efficiency of the scanner in the LiDAR Equation (Höfle & Pfeifer 2007) (default: 0.99)."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
              <div class="control">
                <input class="input" type="text" name="@opticalEfficiency" placeholder="Efficiency of the scanner (default:0.99)">
              </div>
            </div>

            <div class="field">
              <label class="label">Atmospheric Visibility<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Used to calculate atmospheric attenuation, i.e. formula by Carlsson et al. (2001). The calculation depends on the wavelength (default: 23.0 km)."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
              <div class="control">
                <input class="input" type="text" name="@atmosphericVisibility_km" placeholder="Used to calculate atmospheric attenuation [km] (default: 23.0 km)">
              </div>
            </div>

            <div class="field">
              <label class="label">Receiver Diameter</label>
              <div class="control">
                <input class="input" type="text" name="@receiverDiameter_m" placeholder=" Unused [meters] (default: 0.15 m)">
              </div>
            </div>

            <div class="field">
              <label class="label"> Head Rotate Axis</label>
              <div class="control">
                 X-Axis: <input type="text" name="headRotateAxis-@x" placeholder="Axis around which the scanner head is rotated (X-axis)">
                 Y-Axis: <input type="text" name="headRotateAxis-@y" placeholder="Axis around which the scanner head is rotated (Y-axis)">
                 Z-Axis: <input type="text" name="headRotateAxis-@z" placeholder="Axis around which the scanner head is rotated (Z-axis)">
              </div>
            </div>
            <div class="field">
              <label class="label"> Beam Origin Axis<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip=" Origin of the laser beam. The position (x,y,z coordinates) and the attitude (rotations about X,Y,Z) can be provided. The offset and rotations are defined in the same manner as for the scannerMount tag in the Platforms XML. By default, the beam origin is assumed to be in the center of the scanner, and the axes of the beam to be aligned with the axes of the scanner. The rotation defined in <beamOrigin> is applied before the one of the <scannerMount> in the Platforms XML. We suggest to use the beamOrigin rotation to point the scanner downwards and have it scan left-to-right (for airborne systems), as this is the default use case. If no rotation is provided, the scanner looks to the front of the platform and scans up-down:"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                <div class="control mb-3">
                  X-Axis: <input type="text" name="beamOrigin-@x" placeholder="Origin of the laser beam. Position X coordinate">
                  Y-Axis: <input type="text" name="beamOrigin-@y" placeholder="Origin of the laser beam. Position Y coordinate">
                  Z-Axis: <input type="text" name="beamOrigin-@z" placeholder="Origin of the laser beam. Position Z coordinate">
                </div>
                <div class="control">
                    Rotation x-axis: <input type="text" name="beamOrigin-rot-@axis-x-@angle_deg" placeholder="Origin of the laser beam. Altitude X rotation">
                    Rotation y-axis: <input type="text" name="beamOrigin-rot-@axis-y-@angle_deg" placeholder="Origin of the laser beam. Altitude Y rotation">
                    Rotation z-axis: <input type="text" name="beamOrigin-rot-@axis-z-@angle_deg" placeholder="Origin of the laser beam. Altitude Z rotation">
                </div>
            </div>

            <h3 class="subtitle">Scanner Settings</h3>
            <div class="field">
              <label class="label">Pulse Repetition Frequency (PRF)<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Number of laser pulses per second [Hz] (default: 0.0)"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@pulseFreq_hz" placeholder="Number of laser pulses per second [Hz] (default: 0.0)">
                  </div>
           </div>
           <div class="field">
              <label class="label">Default Scan Angle<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="(Vertical) half scan angle in degrees. scanAngle_deg = 30 corresponds to +- 30° (60° swath)"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@scanAngle_deg" placeholder="(Vertical) half scan angle in degrees [deg]">
                  </div>
           </div>
           <div class="field">
              <label class="label">Default Scan Frequency</label>
                  <div class="control">
                    <input class="input" type="text" name="@scanFreq_hz" placeholder=" Number of scan lines per second [Hz] (default: 0.0)">
                  </div>
           </div>
           <div class="field">
              <label class="label">Default Head Rotate Per Seconds</label>
                  <div class="control">
                    <input class="input" type="text" name="@headRotatePerSec_deg" placeholder="Head Rotate Per Seconds in deg">
                  </div>
           </div>


           <div class="field">
              <label class="label">Head Rotate Start <span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Angles to start and stop scanner head rotation to define the horizontal FOV. 0° is pointing to the primary (i.e. X-) axis of the scene coordinate system. If using a projected coordinate system like UTM, the primary axis is pointing north. Angles are assumed mathematically positive, i.e. going counter-clockwise, which is contrary to an azimuth value."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@headRotateStart_deg" placeholder="Angles to start scanner head rotation to define the horizontal FOV [deg]">
                  </div>
           </div>
           <div class="field">
              <label class="label">Head Rotate Stop <span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Angles to start and stop scanner head rotation to define the horizontal FOV. 0° is pointing to the primary (i.e. X-) axis of the scene coordinate system. If using a projected coordinate system like UTM, the primary axis is pointing north. Angles are assumed mathematically positive, i.e. going counter-clockwise, which is contrary to an azimuth value."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@headRotateStop_deg" placeholder="Angles to stop scanner head rotation to define the horizontal FOV [deg]">
                  </div>
           </div>

           <div class="field">
              <label class="label">Head Rotate Per Segment<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Speed of scanner head rotation in degrees per second. Can be positive for counterclockwise rotation or negative for clockwise rotation. Make sure that headRotateStart_deg is larger than headRotateStop_deg if setting a negative value."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@headRotatePerSeg_deg" placeholder="Speed of scanner head rotation in degrees per second [deg]">
                  </div>
           </div>

            <div class="field">
              <label class="label">Default Trajectory Time Interval<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Time interval in seconds for the trajectory output file. If this is set to 0, no trajectory is written. For a measurement frequency of 100 Hz, enter 0.01 (default: 0.0)"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@trajectoryTimeInterval_s" placeholder="Time interval in seconds for the trajectory output file (default: 0.0)">
                  </div>
           </div>

           <div class="field">
              <label class="label">Minimum Vertical Angle<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip=" Independent minimum vertical scan angle. Can be positive or negative. scanAngle_deg=30 would correspond to verticalAngleMin_deg=-30 and verticalAngleMax_deg = 30. We suggest to use the +- scan angle range for ALS surveys, and setting the minimum and maximum vertical angles for TLS surveys."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@verticalAngleMin_deg" placeholder="Independent minimum vertical scan angle [deg] ">
                  </div>
           </div>


           <div class="field">
              <label class="label">Maximum Vertical Angle<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip=" Independent maximum vertical scan angle. Can be positive or negative. scanAngle_deg=30 would correspond to verticalAngleMin_deg=-30 and verticalAngleMax_deg = 30. We suggest to use the +- scan angle range for ALS surveys, and setting the minimum and maximum vertical angles for TLS surveys."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@verticalAngleMax_deg" placeholder="Independent maximum vertical scan angle [deg]">
                  </div>
           </div>

           <div class="field">
              <label class="label">Scanner is Active<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip='Boolean, "true" or "false". This parameter is relevant e.g. for offline (i.e. scanner is turned off) flight lines in airborne surveys. (default: "true").'> <i class="fas fa-info-circle has-text-info"></i> </span></label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="@active" value="true">
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="@active" value="false">
                    False
                  </label>
               </div>
           </div>

                <input class="button is-primary" id="add-scanner" type="submit" value="Add" />
            </form>
        </div>
    </section>
  </div>
</div>

<div class="modal" id="modal-platform">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">Add New Platform</p>
      <button class="delete" aria-label="close" onclick="toggleModal('modal-platform')"></button>
    </header>
    <section class="modal-card-body">
        <div class="content">
          <form id="platform-form">
           <div class="field">
              <label class="label">ID</label>
              <div class="control">
                <input class="input" name="@id" type="text" placeholder="platform id" value="" required>
              </div>
            </div>
            <h3 class="subtitle">Platform Definitions</h3>
            <div class="field">
              <label class="label">Name</label>
              <div class="control">
                <input class="input" type="text" name="@name" placeholder="name" value="" required>
              </div>
            </div>

            <div class="field">
              <label class="label">Platform Type<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip='Possible values: "static", "multicopter", "linearpath", "groundvehicle";any other entries will use the default static platform'> <i class="fas fa-info-circle has-text-info"></i> </span></label>
              <div class="control">
                <input class="input" type="text" name="@type" placeholder="platform type" value="" required>
              </div>
            </div>

            <div class="field">
              <label class="label">Drag</label>
              <div class="control">
                <input class="input" type="text" name="@drag" placeholder="drag value" value="" >
              </div>
            </div>

            <div class="field">
              <label class="label">Maximum Engine Force</label>
              <div class="control">
                <input class="input" type="text" name="@engine_max_force" placeholder="maximum engine force" value="" >
              </div>
            </div>

            <div class="field">
              <label class="label">Speedup Magnitude</label>
              <div class="control">
                <input class="input" type="text" name="@speedup_magnitude" placeholder="speedup magnitude" value="" >
              </div>
            </div>

            <div class="field">
              <label class="label">Slowdown Magnitude</label>
              <div class="control">
                <input class="input" type="text" name="@slowdown_magnitude" placeholder="slowdown magnitude" value="" >
              </div>
            </div>

            <div class="field">
              <label class="label">Slowdown Distance</label>
              <div class="control">
                <input class="input" type="text" name="@slowdown_distance" placeholder="slowdown distance" value="" >
              </div>
            </div>

            <div class="field">
              <label class="label">Base Pitch</label>
              <div class="control">
                <input class="input" type="text" name="@base_pitch_deg" placeholder="base pitch degrees" value="" >
              </div>
            </div>

            <div class="field">
              <label class="label">Roll Speed</label>
              <div class="control">
                <input class="input" type="text" name="@roll_speed_deg" placeholder="roll speed degrees" value="" >
              </div>
            </div>


            <div class="field">
              <label class="label">Pitch Speed</label>
              <div class="control">
                <input class="input" type="text" name="@pitch_speed_deg" placeholder="pitch speed degrees" value="" >
              </div>
            </div>


            <div class="field">
              <label class="label">Yaw Speed</label>
              <div class="control">
                <input class="input" type="text" name="@yaw_speed_deg" placeholder="yaw speed degrees" value="" >
              </div>
            </div>


            <div class="field">
              <label class="label">Roll Offset</label>
              <div class="control">
                <input class="input" type="text" name="@roll_offset_deg" placeholder="roll offset degrees" value="" >
              </div>
            </div>

            <div class="field">
              <label class="label">Pitch Offset</label>
              <div class="control">
                <input class="input" type="text" name="@pitch_offset_deg" placeholder="pitch offset degrees" value="" >
              </div>
            </div>

            <div class="field">
              <label class="label"> Scanner Mount Axis</label>
                <div class="control">
                  X-Axis: <input type="text" name="scannerMount-@x" placeholder="Scanner Mount X-axis" value="">
                  Y-Axis: <input type="text" name="scannerMount-@y" placeholder="Scanner Mount Y-axis" value="">
                  Z-Axis: <input type="text" name="scannerMount-@z" placeholder="Scanner Mount Z-axis" value="">
                  Rotations: <input type="text" name="scannerMount-@rotations" placeholder="Scanner Mount Rotations" value="">
                </div>

                <div class="control mt-4">

                        Rotation x-axis: <input type="text" name="scannerMount-rot-@axis-x-@angle_deg" placeholder="Rotation X-axis" value="0">
                        Rotation y-axis: <input type="text" name="scannerMount-rot-@axis-y-@angle_deg" placeholder="Rotation Y-axis" value="0">
                        Rotation z-axis: <input type="text" name="scannerMount-rot-@axis-z-@angle_deg" placeholder="Rotation Z-axis" value="0">
                </div>
            </div>
              <h3 class="subtitle">Platform Settings</h3>
              <div class="field">
              <label class="label">Move per Second</label>
              <div class="control">
                <input class="input" type="text" name="@movePerSec_m" placeholder="Move per Second Meters" value="" >
              </div>
            </div>

           <div class="field">
              <label class="label">On Ground</label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="@onGround" value="true">
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="@onGround" value="false">
                    False
                  </label>
               </div>
           </div>
           <div class="field">
              <label class="label">Stop and Turn</label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="@stopAndTurn" value="true" >
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="@stopAndTurn" value="false" >
                    False
                  </label>
               </div>
           </div>

           <div class="field">
              <label class="label">Smooth Turn</label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="@smoothTurn" value="true" >
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="@smoothTurn" value="false" >
                    False
                  </label>
               </div>
           </div>

            <div class="field">
              <label class="label">Enable Slowdown</label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="@slowdownEnabled" value="true">
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="@slowdownEnabled" value="false" >
                    False
                  </label>
               </div>
           </div>

           <div class="field">
              <label class="label">Yaw at Departure</label>
                  <div class="control">
                    <input class="input" type="text" name="@yawAtDeparture_deg" placeholder="Yaw at Departure in degree" value="">
                  </div>
           </div>

              <input class="button is-primary" id="add-platform" type="submit" value="Add" />
            </form>
        </div>
    </section>
  </div>
</div>
<div class="hero-body">
    <div class="container">
    <div class="columns">
      <div class="column is-4 has-background-light">
        <form id="survey-form" method="post" action="">
        <h1 class="title">Create Survey</h1>
          <div class="card is-fullwidth">
            <header class="card-header">
                <p class="card-header-title">Show/Manage Waypoints ({{message['waypoints']|length}})</p>
                <a class="card-header-icon card-toggle">
                    <i class="fa fa-angle-down"></i>
                </a>
            </header>
            <div class="card-content is-hidden">
                <div class="content">
                  <h3 class="subtitle">Waypoints </h3>
                    <div id="waypoints">
                        {% for waypoint in message['waypoints'] %}
                            <div class="card is-fullwidth mb-3">
                                <header class="card-header">
                                    <p class="card-header-title">Waypoint {{loop.index}}</p>
                                    <a class="card-header-icon delete-card">
                                        <i class="fa fa-times-circle"></i>
                                    </a>
                                    <a class="card-header-icon card-toggle">
                                        <i class="fa fa-angle-down"></i>
                                    </a>
                                </header>
                                <div class="card-content is-hidden">
                                    <div class="content">
                                <h3 class="subtitle">Platform Setting</h3>
                                <div class="field">
                                  <label class="label"></label>
                                      <div class="control">
                                        X-axis<input class="input" type="text" name="waypoint-platform-{{loop.index}}-setting-@x" placeholder="x" value="{{waypoint[0]}}">
                                        Y-axis<input class="input" type="text" name="waypoint-platform-{{loop.index}}-setting-@y" placeholder="y" value="{{waypoint[1]}}">
                                        Z-axis<input class="input" type="text" name="waypoint-platform-{{loop.index}}-setting-@z" placeholder="z" value="{{waypoint[2]}}">
                                      </div>
                               </div>
                               <div class="field">
                                  <label class="label">On Ground</label>
                                   <div class="control">
                                      <label class="radio">
                                        <input type="radio" name="waypoint-platform-{{loop.index}}-setting-@onGround" value="true">
                                        True
                                      </label>
                                      <label class="radio">
                                        <input type="radio" name="waypoint-platform-{{loop.index}}-setting-@onGround" value="false" checked>
                                        False
                                      </label>
                                   </div>
                               </div>
                               <div class="field">
                                  <label class="label">Move Per Second</label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-platform-{{loop.index}}-setting-@movePerSec_m" placeholder="Move Per Second in meter">
                                      </div>
                               </div>
                                <div class="field">
                                  <label class="label">Stop and Turn</label>
                                   <div class="control">
                                      <label class="radio">
                                        <input type="radio" name="waypoint-{{loop.index}}-setting-@stopAndTurn" value="true" checked>
                                        True
                                      </label>
                                      <label class="radio">
                                        <input type="radio" name="waypoint-{{loop.index}}-setting-@stopAndTurn" value="false" >
                                        False
                                      </label>
                                   </div>
                               </div>

                               <div class="field">
                                  <label class="label">Smooth Turn</label>
                                   <div class="control">
                                      <label class="radio">
                                        <input type="radio" name="waypoint-{{loop.index}}-setting-@smoothTurn" value="true" >
                                        True
                                      </label>
                                      <label class="radio">
                                        <input type="radio" name="waypoint-{{loop.index}}-setting-@smoothTurn" value="false"checked >
                                        False
                                      </label>
                                   </div>
                               </div>

                                <div class="field">
                                  <label class="label">Enable Slowdown</label>
                                   <div class="control">
                                      <label class="radio">
                                        <input type="radio" name="waypoint-{{loop.index}}-setting-@slowdownEnabled" value="true" checked>
                                        True
                                      </label>
                                      <label class="radio">
                                        <input type="radio" name="waypoint-{{loop.index}}-setting-@slowdownEnabled" value="false" >
                                        False
                                      </label>
                                   </div>
                               </div>

                               <div class="field">
                                  <label class="label">Yaw at Departure</label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-platform-{{loop.index}}-setting-@yawAtDeparture_deg" placeholder="Yaw at Departure in degree">
                                      </div>
                               </div>

                    
                                <h3 class="subtitle">Scanner Setting</h3>
                                <div class="field">
                                  <label class="label">ID</label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-setting-@id" placeholder="ID">
                                      </div>
                               </div>
                               <div class="field">
                                  <label class="label">Pulse Repetition Frequency (PRF) <span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Number of laser pulses per second [Hz] (default: 0.0)"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-setting-@pulseFreq_hz" placeholder="Number of laser pulses per second [Hz] (default: 0.0)">
                                      </div>
                               </div>
                               <div class="field">
                                  <label class="label">Scan Angle<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="(Vertical) half scan angle in degrees. scanAngle_deg = 30 corresponds to +- 30° (60° swath)"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-setting-@scanAngle_deg" placeholder="(Vertical) half scan angle in degrees [deg]">
                                      </div>
                               </div>
                               <div class="field">
                                  <label class="label">Scan Frequency</label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-setting-@scanFreq_hz" placeholder="Number of scan lines per second [Hz] (default: 0.0)">
                                      </div>
                               </div>
                               <div class="field">
                                  <label class="label">Head Rotate Per Seconds</label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-setting-@headRotatePerSec_deg" placeholder="Head Rotate Per Seconds in deg">
                                      </div>
                               </div>

                                <div class="field">
                                  <label class="label">Minimum Vertical Angle<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip=" Independent minimum vertical scan angle. Can be positive or negative. scanAngle_deg=30 would correspond to verticalAngleMin_deg=-30 and verticalAngleMax_deg = 30. We suggest to use the +- scan angle range for ALS surveys, and setting the minimum and maximum vertical angle for TLS surveys."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-setting-@verticalAngleMin_deg" placeholder="Independent minimum vertical scan angle [deg]">
                                      </div>
                               </div>

                               <div class="field">
                                  <label class="label">Maximum Vertical Angle<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip=" Independent maximum vertical scan angle. Can be positive or negative. scanAngle_deg=30 would correspond to verticalAngleMin_deg=-30 and verticalAngleMax_deg = 30. We suggest to use the +- scan angle range for ALS surveys, and setting the minimum and maximum vertical angles for TLS surveys."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-setting-@verticalAngleMax_deg" placeholder="Independent maximum vertical scan angle [deg]">
                                      </div>
                               </div>

                               <div class="field">
                                  <label class="label">Head Rotate Start<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Angles to start and stop scanner head rotation to define the horizontal FOV. 0° is pointing to the primary (i.e. X-) axis of the scene coordinate system. If using a projected coordinate system like UTM, the primary axis is pointing north. Angles are assumed mathematically positive, i.e. going counter-clockwise, which is contrary to an azimuth value."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-setting-@headRotateStart_deg" placeholder="Angles to start scanner head rotation to define the horizontal FOV [deg]">
                                      </div>
                               </div>
                               <div class="field">
                                  <label class="label">Head Rotate Stop<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Angles to start and stop scanner head rotation to define the horizontal FOV. 0° is pointing to the primary (i.e. X-) axis of the scene coordinate system. If using a projected coordinate system like UTM, the primary axis is pointing north. Angles are assumed mathematically positive, i.e. going counter-clockwise, which is contrary to an azimuth value."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-setting-@headRotateStop_deg" placeholder="Angles to stop scanner head rotation to define the horizontal FOV [deg]">
                                      </div>
                               </div>

                               <div class="field">
                                  <label class="label">Head Rotate Per Segment<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Speed of scanner head rotation in degrees per second. Can be positive for counterclockwise rotation or negative for clockwise rotation. Make sure that headRotateStart_deg is larger than headRotateStop_deg if setting a negative value."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-@headRotatePerSeg_deg" placeholder="Speed of scanner head rotation in degrees per second [deg]">
                                      </div>
                               </div>
                                <div class="field">
                                  <label class="label">Trajectory Time Interval<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Time interval in seconds for the trajectory output file. If this is set to 0, no trajectory is written. For a measurement frequency of 100 Hz, enter 0.01 (default: 0.0)"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                                      <div class="control">
                                        <input class="input" type="text" name="waypoint-{{loop.index}}-setting-@trajectoryTimeInterval_s" placeholder="Time interval in seconds for the trajectory output file (default: 0.0)">
                                      </div>
                               </div>


                               <div class="field">
                                  <label class="label">Scanner is Active<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip='Boolean, "true" or "false". This parameter is relevant e.g. for offline (i.e. scanner is turned off) flight lines in airborne surveys. (default: "true").'> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                                   <div class="control">
                                      <label class="radio">
                                        <input type="radio" name="waypoint-{{loop.index}}-setting-@active" value="true" checked>
                                        True
                                      </label>
                                      <label class="radio">
                                        <input type="radio" name="waypoint-{{loop.index}}-setting-@active" value="false">
                                        False
                                      </label>
                                   </div>
                               </div>
                               </div>
                               </div>
                            </div>
                        {% endfor %}
                    </div>
                    <button type="button" id="add-new-waypoint" class="button is-primary">Add New Waypoint</button>
                </div>
            </div>
          </div>
            <hr class="navbar-divider has-background-white"/>

          <h3 class="subtitle">Survey Settings</h3>
          <div class="field">
              <label class="label">Survey Name</label>
                  <div class="control">
                    <input class="input" type="text" name="survey-setting-@name" placeholder="Survey Name" required>
                    <p class="help is-danger">This field is required</p>
                  </div>
           </div>
           <div class="mb-3">
           <div class="select float-left mr-4">
              <select name="survey-setting-@scanner" id="survey-scanner" onchange="handleScannerChange(event)">
                <option>Select Scanner</option>
                 {% for scanner in message['scanners']['document']['scanner'] %}
                <option value="{{scanner['@id']}}">{{scanner['@name']}}</option>
                  {% endfor %}
              </select>
           </div>
           <button class="button is-primary forced-width" type="button" onclick="toggleModal('modal-scanner')">Add New Scanner</button>
           </div>
           <div class="mb-3">
           <div class="select float-left mr-4">
              <select name="survey-setting-@platform" id="survey-platform" onchange="handlePlatformChange(event)">
                <option>Select Platform</option>
                  {% for platform in message['platforms']['document']['platform'] %}
                <option value="{{platform['@id']}}">{{platform['@name']}}</option>
                  {% endfor %}
              </select>
           </div>
           <button class="button is-primary forced-width" type="button" onclick="toggleModal('modal-platform')">Add New Platform</button>
           </div>
           <div class="mb-3">
           <div class="select float-left mr-4 mb-3">
              <select name="survey-setting-@scene" id="survey-scene">
                <option>Select Scene</option>
                  {% for scene in message['scenes'] %}
                <option value="{{scene}}">{{scene}}</option>
                  {% endfor %}
              </select>
           </div>
           <button class="button is-primary forced-width" type="button" onclick="toggleModal('modal-scene')">Add New Scene</button>
           </div>

         <!-- <hr class="navbar-divider has-background-white"/>
        <h3 class="subtitle">Default Scanner Settings</h3>
           <div class="field">
              <label class="label">ID</label>
                  <div class="control">
                    <input class="input" type="text" name="scanner-setting-@id" placeholder="ID">
                  </div>
           </div>
           <div class="field">
              <label class="label">Pulse Repetition Frequency (PRF)</label>
                  <div class="control">
                    <input class="input" type="text" name="scanner-setting-@pulseFreq_hz" placeholder="Number of laser pulses per second [Hz] (default: 0.0)">
                  </div>
           </div>
           <div class="field">
              <label class="label">Scan Angle</label>
                  <div class="control">
                    <input class="input" type="text" name="scanner-setting-@scanAngle_deg" placeholder="Scan angle in deg">
                  </div>
           </div>
           <div class="field">
              <label class="label">Scan Frequency</label>
                  <div class="control">
                    <input class="input" type="text" name="scanner-setting-@scanFreq_hz" placeholder="Number of scan lines per second [Hz] (default: 0.0)">
                  </div>
           </div>
           <div class="field">
              <label class="label">Head Rotate Per Seconds</label>
                  <div class="control">
                    <input class="input" type="text" name="scanner-setting-@headRotatePerSec_deg" placeholder="Head Rotate Per Seconds in deg">
                  </div>
           </div>
           <div class="field">
              <label class="label">Head Rotate Start</label>
                  <div class="control">
                    <input class="input" type="text" name="scanner-setting-@headRotateStart_deg" placeholder="Head Rotate Start in deg">
                  </div>
           </div>
           <div class="field">
              <label class="label">Head Rotate Stop</label>
                  <div class="control">
                    <input class="input" type="text" name="scanner-setting-@headRotateStop_deg" placeholder="Head Rotate Stop in deg">
                  </div>
           </div>
            <div class="field">
              <label class="label">Trajectory Time Interval</label>
                  <div class="control">
                    <input class="input" type="text" name="scanner-setting-@trajectoryTimeInterval_s" placeholder="Trajectory Time Interval">
                  </div>
           </div>

           <div class="field">
              <label class="label">Active</label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="scanner-setting-@active" value="true" checked>
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="scanner-setting-@active" value="false">
                    False
                  </label>
               </div>
           </div> -->
           <hr class="navbar-divider has-background-white"/>
            <h3 class="subtitle">Full Waveform Settings</h3>
            <div class="field">
              <label class="label">Beam Sample Quality<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Quality of spatial discretisation of the subrays (higher value = more subrays within the laser cone). (default: 3 ( = 19 subrays))."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@beamSampleQuality" placeholder="Quality of spatial discretization of the subrays ">
                  </div>
            </div>
            <div class="field">
              <label class="label">Bin Size<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip=" Size of bins to discretise the entire temporal domain of the FWF signal [ns]. It determines the number of bins:numFullwaveBin = floor[min(maxHitTime_ns - minHitTime_ns, maxFullwaveRange_ns) / binSize_ns] (default: 0.25)."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@binSize_ns" placeholder="Size of bins to discretize the entire temporal domain of the FWF signal [ns] (default: 0.25)">
                  </div>
            </div>
            <div class="field">
              <label class="label">Maximum Full Wave Range<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Maximum range of the full waveform [ns]. It is used to avoid negative influences on runtime in case of large ranges. Information after minHitTime_ns+maxFullwaveRange is discarded and a warning message is displayed. The maxFullwaveRange_ns is only applied if it is larger than 0 (default: 0)."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@maxFullwaveRange_ns" placeholder="Maximum range of the full waveform [ns] (default: 0)">
                  </div>
            </div>
            <div class="field">
              <label class="label">Window Size<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Number of neighboring samples to check (i.e. 1D window size) when finding local maxima for Gaussian decomposition (default: (Pulse Length in ns)/4, see Scanner definition"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="@winSize_ns" placeholder="Number of neighbouring samples to check [ns]">
                  </div>
            </div>
            <hr class="navbar-divider has-background-white"/>

            <div class="field is-grouped mt-3">
             <div class="control">
                <input type="submit" class="button is-link" value="Run">
            </div>
            <!--<div class="control">
                <a href="/survey-download" class="button is-link is-light">Download Survey</a>
            </div>-->
        </div>
        </form>
      </div>
      <div class="column is-8">

      </div>
    </div>
    </div>
</div>
<script>
window.addEventListener('load', (event) => {
  let waypoint_count = {{message['waypoints']|length + 1}}
  document.getElementById('add-new-waypoint').onclick = function () {
    let waypoint_template = `
            <header class="card-header">
				<p class="card-header-title">Waypoint ${waypoint_count}</p>
				<a class="card-header-icon delete-card">
                    <i class="fa fa-times-circle"></i>
                </a>
				<a class="card-header-icon card-toggle">
					<i class="fa fa-angle-down"></i>
				</a>
			</header>
			<div class="card-content is-hidden">
			    <div class="content">
			<h3 class="subtitle">Platform Setting</h3>
            <div class="field">
              <label class="label"></label>
                  <div class="control">
                    X-axis<input class="input" type="text" name="waypoint-platform-${waypoint_count}-setting-@x" placeholder="x">
                    Y-axis<input class="input" type="text" name="waypoint-platform-${waypoint_count}-setting-@y" placeholder="y">
                    Z-axis<input class="input" type="text" name="waypoint-platform-${waypoint_count}-setting-@z" placeholder="z">
                  </div>
           </div>
           <div class="field">
              <label class="label">On Ground</label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="waypoint-platform-${waypoint_count}-setting-@onGround" value="true">
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="waypoint-platform-${waypoint_count}-setting-@onGround" value="false" checked>
                    False
                  </label>
               </div>
           </div>
           <div class="field">
                  <label class="label">Move per Second</label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-platform-${waypoint_count}-setting-@movePerSec_m" placeholder="Move per Second Meters" value="${selectedPlatform['@movePerSec_m']? selectedPlatform['@movePerSec_m']: '' }">
                  </div>
           </div>


            <div class="field">
              <label class="label">Stop and Turn</label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="waypoint-platform-${waypoint_count}-setting-@stopAndTurn" value="true" checked>
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="waypoint-platform-${waypoint_count}-setting-@stopAndTurn" value="false">
                    False
                  </label>
               </div>
           </div>

           <div class="field">
              <label class="label">Smooth Turn</label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="waypoint-platform-${waypoint_count}-setting-@smoothTurn" value="true">
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="waypoint-platform-${waypoint_count}-setting-@smoothTurn" value="false"checked>
                    False
                  </label>
               </div>
           </div>

            <div class="field">
              <label class="label">Enable Slowdown</label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="waypoint-platform-${waypoint_count}-setting-@slowdownEnabled" value="true" checked>
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="waypoint-platform-${waypoint_count}-setting-@slowdownEnabled" value="false">
                    False
                  </label>
               </div>
           </div>

           <div class="field">
              <label class="label">Yaw at Departure</label>
                  <div class="control">
                    <input class="input" type="text" value="${selectedPlatform['@yawAtDeparture_deg']? selectedPlatform['@yawAtDeparture_deg']: '' }" name="waypoint-platform-${waypoint_count}-setting-@yawAtDeparture_deg" placeholder="Yaw at Departure in degree">
                  </div>
           </div>


			<h3 class="subtitle">Scanner Setting</h3>
            <div class="field">
              <label class="label">ID</label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-setting-@id" placeholder="ID" value="${selectedScanner['@id']? selectedScanner['@id']: '' }">
                  </div>
           </div>
           <div class="field">
              <label class="label">Pulse Repetition Frequency<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Number of laser pulses per second [Hz] (default: 0.0)"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-setting-@pulseFreq_hz" placeholder="Number of laser pulses per second [Hz] (default: 0.0)" value="${selectedScanner['@pulseFreq_hz']? selectedScanner['@pulseFreq_hz']: '' }">
                  </div>
           </div>
           <div class="field">
              <label class="label">Scan Angle<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="(Vertical) half scan angle in degrees. scanAngle_deg = 30 corresponds to +- 30° (60° swath)"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-setting-@scanAngle_deg" placeholder="(Vertical) half scan angle in degrees [deg]" value="${selectedScanner['@scanAngle_deg']? selectedScanner['@scanAngle_deg']: '' }">
                  </div>
           </div>
           <div class="field">
              <label class="label">Scan Frequency</label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-setting-@scanFreq_hz" placeholder="Number of scan lines per second [Hz] (default: 0.0)" value="${selectedScanner['@scanFreq_hz']? selectedScanner['@scanFreq_hz']: '' }">
                  </div>
           </div>
           <div class="field">
              <label class="label">Head Rotate Per Seconds</label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-setting-@headRotatePerSec_deg" placeholder="Head Rotate Per Seconds in deg" value="${selectedScanner['@headRotatePerSec_deg']? selectedScanner['@headRotatePerSec_deg']: '' }">
                  </div>
           </div>

           <div class="field">
              <label class="label">Minimum Vertical Angle<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip=" Independent minimum and maximum vertical scan angle. Can be positive or negative. scanAngle_deg=30 would correspond to verticalAngleMin_deg=-30 and verticalAngleMax_deg = 30. We suggest to use the +- scan angle range for ALS surveys, and setting the minimum and maximum vertical angles for TLS surveys."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-setting-@verticalAngleMin_deg" placeholder="Independent minimum vertical scan angle [deg]" value="${selectedScanner['@verticalAngleMin_deg']? selectedScanner['@verticalAngleMin_deg']: '' }">
                  </div>
           </div>

           <div class="field">
              <label class="label">Maximum Vertical Angle<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip=" Independent minimum and maximum vertical scan angle. Can be positive or negative. scanAngle_deg=30 would correspond to verticalAngleMin_deg=-30 and verticalAngleMax_deg = 30. We suggest to use the +- scan angle range for ALS surveys, and setting the minimum and maximum vertical angles for TLS surveys."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-setting-@verticalAngleMax_deg" placeholder="Independent maximum vertical scan angle [deg]" value="${selectedScanner['@verticalAngleMax_deg']? selectedScanner['@verticalAngleMax_deg']: '' }">
                  </div>
           </div>

           <div class="field">
              <label class="label">Head Rotate Start<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Angles to start and stop scanner head rotation to define the horizontal FOV. 0° is pointing to the primary (i.e. X-) axis of the scene coordinate system. If using a projected coordinate system like UTM, the primary axis is pointing north. Angles are assumed mathematically positive, i.e. going counter-clockwise, which is contrary to an azimuth value."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-setting-@headRotateStart_deg" placeholder="Angles to start scanner head rotation to define the horizontal FOV [deg]" value="${selectedScanner['@headRotateStart_deg']? selectedScanner['@headRotateStart_deg']: '' }">
                  </div>
           </div>
           <div class="field">
              <label class="label">Head Rotate Stop<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Angles to start and stop scanner head rotation to define the horizontal FOV. 0° is pointing to the primary (i.e. X-) axis of the scene coordinate system. If using a projected coordinate system like UTM, the primary axis is pointing north. Angles are assumed mathematically positive, i.e. going counter-clockwise, which is contrary to an azimuth value."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-setting-@headRotateStop_deg" placeholder="Angles to stop scanner head rotation to define the horizontal FOV [deg]" value="${selectedScanner['@headRotateStop_deg']? selectedScanner['@headRotateStop_deg']: '' }">
                  </div>
           </div>

           <div class="field">
              <label class="label">Head Rotate Per Segment<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Speed of scanner head rotation in degrees per second. Can be positive for counterclockwise rotation or negative for clockwise rotation. Make sure that headRotateStart_deg is larger than headRotateStop_deg if setting a negative value."> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-@headRotatePerSeg_deg" placeholder="Speed of scanner head rotation in degrees per second [deg]" value="${selectedScanner['@headRotatePerSeg_deg']? selectedScanner['@headRotatePerSeg_deg']: '' }">
                  </div>
           </div>

            <div class="field">
              <label class="label">Trajectory Time Interval<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip="Time interval in seconds for the trajectory output file. If this is set to 0, no trajectory is written. For a measurement frequency of 100 Hz, enter 0.01 (default: 0.0)"> <i class="fas fa-info-circle has-text-info"></i> </span></label>
                  <div class="control">
                    <input class="input" type="text" name="waypoint-${waypoint_count}-setting-@trajectoryTimeInterval_s" placeholder="Time interval in seconds for the trajectory output file (default: 0.0)" value="${selectedScanner['@trajectoryTimeInterval_s']? selectedScanner['@trajectoryTimeInterval_s']: '' }">
                  </div>
           </div>

           <div class="field">
              <label class="label">Scanner is Active<span class="has-tooltip-arrow has-tooltip-multiline" data-tooltip='Boolean, "true" or "false". This parameter is relevant e.g. for offline (i.e. scanner is turned off) flight lines in airborne surveys. (default: "true").'> <i class="fas fa-info-circle has-text-info"></i> </span></label>
               <div class="control">
                  <label class="radio">
                    <input type="radio" name="waypoint-${waypoint_count}-setting-@active" value="true" checked>
                    True
                  </label>
                  <label class="radio">
                    <input type="radio" name="waypoint-${waypoint_count}-setting-@active" value="false">
                    False
                  </label>
               </div>
           </div>
           </div>
           </div>
           `
let container = document.getElementById('waypoints')
    let div = document.createElement('div')
    div.classList.add(...['card', 'is-fullwidth', 'mb-3'])
    div.innerHTML = waypoint_template
    div.getElementsByClassName('card-toggle')[0].addEventListener('click', e => {
        e.currentTarget.parentElement.parentElement.childNodes[3].classList.toggle('is-hidden')
    })
    div.getElementsByClassName('delete-card')[0].addEventListener('click', e => {
        e.currentTarget.parentElement.parentElement.remove()
    })
    container.appendChild(div)
    waypoint_count++
  }

})

function toggleModal(id) {
  document.getElementById(id).classList.toggle('is-active')
}

function killHelios() {
  document.getElementById('modal').classList.toggle('is-active');
  const XHR = new XMLHttpRequest();
   XHR.addEventListener( "load", function(event) {
       console.log('Helios killed')
   });

   XHR.addEventListener( "error", function(event) {
       console.log(event.target)
   });

       // Set up our request
    XHR.open( "GET", "/kill-helios" );

    XHR.send();

}

function enableHeliosDownload(enableOrDisable) {
    document.getElementById("download_helios_output").disabled=enableOrDisable
}

function downloadHeliosOutput() {
  survey_name = document.getElementsByName("survey-setting-@name")[0].value
  if(!survey_name.length < 1) {
    window.open(`/download_helios_output/${survey_name}`,'_blank')
  }
}


window.addEventListener( "load", function () {
  function getInitialLogs() {
     const logsXHR = new XMLHttpRequest();
     logsXHR.addEventListener( "load", function(event) {
       let log_container = document.getElementById('logs')
       let div = document.createElement('div')
       div.innerHTML = event.target.responseText
       log_container.appendChild(div)
       div.scrollIntoView()
     });

     logsXHR.addEventListener( "error", function(event) {
       console.log(event.target)
     });

      // Set up our request
     logsXHR.open( "GET", "/initial-logs" );
     logsXHR.send();
  }

  function sendData() {
    const XHR = new XMLHttpRequest();

    // Bind the FormData object and the form element
    const FD = new FormData( _("survey-form") );

    // Define what happens on successful data submission
    XHR.addEventListener( "load", function(event) {
      document.getElementById('logs').innerHTML = ''
      document.getElementById('modal').classList.toggle('is-active')
      let source = new EventSource("/log");
	  source.onmessage = function(event) {
            let log_container = document.getElementById('logs')
            let li = document.createElement('li')
            li.innerText = event.data
            if(li.innerText.includes("Total simulation time")) {
                enableHeliosDownload(false)
            }
            log_container.appendChild(li)
            li.scrollIntoView()
      }
    });

    // Define what happens in case of error
    XHR.addEventListener( "error", function( event ) {
      alert( 'Oops! Something went wrong.' );
    } );

    // Set up our request
    XHR.open( "POST", "/survey" );

    // The data sent is what the user provided in the form
    enableHeliosDownload(true)
    XHR.send( FD );
  }

  // Access the form element...
  const form = document.getElementById( "survey-form" );

  // ...and take over its submit event.
  form.addEventListener( "submit", function ( event ) {
    event.preventDefault();
    sendData();
  });
});



// file upload
function _(el) {
  return document.getElementById(el);
}

function uploadFile() {
  let file = _("file1").files[0];
  // alert(file.name+" | "+file.size+" | "+file.type);
  let formdata = new FormData();
  formdata.append("file1", file);
  var ajax = new XMLHttpRequest();
  ajax.upload.addEventListener("progress", progressHandler, false);
  ajax.addEventListener("load", completeHandler, false);
  ajax.addEventListener("error", errorHandler, false);
  ajax.addEventListener("abort", abortHandler, false);
  ajax.open("POST", "/scene");
  ajax.send(formdata);
}

function progressHandler(event) {
  _("loaded_n_total").innerHTML = "Uploaded " + event.loaded + " bytes of " + event.total;
  var percent = (event.loaded / event.total) * 100;
  _("progressBar").value = Math.round(percent);
  _("status").innerHTML = Math.round(percent) + "% uploaded... please wait";
}

function completeHandler(event) {
  let resp = JSON.parse(event.target.responseText)
    _("status").innerHTML = resp.message;
    _("progressBar").value = 0; //wil clear progress bar after successful upload
    let parentElem = _('survey-scene')
    parentElem.innerHTML = ''
    resp.scenes.map(scene => {
       let opt = document.createElement('option')
       opt.value = scene
       opt.text = scene
       parentElem.appendChild(opt)
    })
}

function errorHandler(event) {
  _("status").innerHTML = "Upload Failed";
}

function abortHandler(event) {
  _("status").innerHTML = "Upload Aborted";
}

function addScanner() {
    const XHR = new XMLHttpRequest();

    // Bind the FormData object and the form element
    const FD = new FormData( _("scanner-form") );

    // Define what happens on successful data submission
    XHR.addEventListener( "load", function(event) {
        _("add-scanner").disabled = false

        let resp = JSON.parse(event.target.responseText)
        _("status").innerHTML = resp.message;
        let parentElem = _('survey-scanner')
        parentElem.innerHTML = ''
        resp.scanners.document.scanner.map(scanner => {
            let opt = document.createElement('option')
            opt.value = scanner['@id']
            opt.text = scanner['@name']
            if(scanner['@id'] === resp.id) { opt.defaultSelected = true }
            parentElem.appendChild(opt)
        });
      let eventChange = new Event('change');
      parentElem.dispatchEvent(eventChange)
      toggleModal('modal-scanner')
    } );

    // Define what happens in case of error
    XHR.addEventListener( "error", function( event ) {
     _("add-scanner").disabled = false
      alert( 'Oops! Something went wrong.' );
    } );

    // Set up our request
    XHR.open( "POST", "/scanner-async" );

    // The data sent is what the user provided in the form
    _("add-scanner").disabled = true
    XHR.send( FD );

}

function addPlatform() {
    const XHR = new XMLHttpRequest();

    // Bind the FormData object and the form element
    const FD = new FormData( _("platform-form") );

    // Define what happens on successful data submission
    XHR.addEventListener( "load", function(event) {
        _("add-platform").disabled = false

        let resp = JSON.parse(event.target.responseText)
        _("status").innerHTML = resp.message;
        let parentElem = _('survey-platform')
        parentElem.innerHTML = ''
        resp.platforms.document.platform.map(platform => {
            let opt = document.createElement('option')
            opt.value = platform['@id']
            opt.text = platform['@name']
            if(platform['@id'] === resp.id) { opt.defaultSelected = true }
            parentElem.appendChild(opt)
        })
      toggleModal('modal-platform')
    } );

    // Define what happens in case of error
    XHR.addEventListener( "error", function( event ) {
     _("add-platform").disabled = false
      alert( 'Oops! Something went wrong.' );
    } );

    // Set up our request
    XHR.open( "POST", "/platform-async" );

    // The data sent is what the user provided in the form
    _("add-platform").disabled = true
    XHR.send( FD );

}

window.addEventListener( "load", function () {
    _("scanner-form").addEventListener( "submit", function ( event ) {
    event.preventDefault();

    addScanner();
  });

  _("platform-form").addEventListener( "submit", function ( event ) {
    event.preventDefault();

    addPlatform();
  });

  // Fetch scanners and platforms asynchronously
  loadEntities()

})

let scanners = []
let platforms = []
let selectedScanner = {}
let selectedPlatform = {}

function loadEntities() {
  const XHR = new XMLHttpRequest();
   XHR.addEventListener( "load", function(event) {
       docs = JSON.parse(event.target.responseText)
       scanners = docs.scanners.document.scanner
       platforms = docs.platforms.document.platform
   });

   XHR.addEventListener( "error", function(event) {
       console.log(event.target)
   });

       // Set up our request
    XHR.open( "GET", "/entities" );

    XHR.send();
}

function handleScannerChange(event) {
    const scannerID = event.target.value
    selectedScanner = scanners.find(item => item['@id'] === scannerID)
    document.querySelectorAll('input[name$="setting-@id"]').forEach((item) => {
        item.value = selectedScanner['@id']? selectedScanner['@id']: null
    })
    document.querySelectorAll('input[name$="setting-@pulseFreq_hz"]').forEach((item) => {
        item.value = selectedScanner['@pulseFreq_hz']? selectedScanner['@pulseFreq_hz']: null
    })
    document.querySelectorAll('input[name$="setting-@scanAngle_deg"]').forEach((item) => {
        item.value = selectedScanner['@scanAngle_deg']? selectedScanner['@scanAngle_deg']: null
    })
    document.querySelectorAll('input[name$="setting-@scanFreq_hz"]').forEach((item) => {
        item.value = selectedScanner['@scanFreq_hz']? selectedScanner['@scanFreq_hz']: null
    })
    document.querySelectorAll('input[name$="setting-@headRotatePerSec_deg"]').forEach((item) => {
        item.value = selectedScanner['@headRotatePerSec_deg']? selectedScanner['@headRotatePerSec_deg']: null
    })
    document.querySelectorAll('input[name$="setting-@verticalAngleMin_deg"]').forEach((item) => {
        item.value = selectedScanner['@verticalAngleMin_deg']? selectedScanner['@verticalAngleMin_deg']: null
    })
    document.querySelectorAll('input[name$="setting-@verticalAngleMax_deg"]').forEach((item) => {
        item.value = selectedScanner['@verticalAngleMax_deg']? selectedScanner['@verticalAngleMax_deg']: null
    })
    document.querySelectorAll('input[name$="setting-@headRotateStart_deg"]').forEach((item) => {
        item.value = selectedScanner['@headRotateStart_deg']? selectedScanner['@headRotateStart_deg']: null
    })
    document.querySelectorAll('input[name$="setting-@headRotateStop_deg"]').forEach((item) => {
        item.value = selectedScanner['@headRotateStop_deg']? selectedScanner['@headRotateStop_deg']: null
    })
    document.querySelectorAll('input[name$="setting-@headRotatePerSeg_deg"]').forEach((item) => {
        item.value = selectedScanner['@headRotatePerSeg_deg']? selectedScanner['@headRotatePerSeg_deg']: null
    })
    document.querySelectorAll('input[name$="setting-@trajectoryTimeInterval_s"]').forEach((item) => {
        item.value = selectedScanner['@trajectoryTimeInterval_s']? selectedScanner['@trajectoryTimeInterval_s']: null
    })
}


function handlePlatformChange(event) {
    const platformID = event.target.value
    selectedPlatform = platforms.find(item => item['@id'] === platformID)

    document.querySelectorAll('input[name$="setting-@movePerSec_m"]').forEach((item) => {
        item.value = selectedPlatform['@movePerSec_m']? selectedPlatform['@movePerSec_m']: null
    })

    document.querySelectorAll('input[name$="setting-@yawAtDeparture_deg"]').forEach((item) => {
        item.value = selectedPlatform['@yawAtDeparture_deg']? selectedPlatform['@yawAtDeparture_deg']: null
    })
}


</script>
{% endblock %}